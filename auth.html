<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest"
        href='data:application/json,{"name":"Succes Class","short_name":"Succes","start_url":"./","display":"standalone","background_color":"#ffffff","theme_color":"#3b82f6","icons":[{"src":"pwa_icon.png","sizes":"512x512","type":"image/png"}]}'>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Succes Class - Login</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-blur: blur(12px);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e0f2fe 100%);
            height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            color: #1f2937;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .input-glass:focus {
            background: #ffffff;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.15);
            outline: none;
        }

        .btn-modern {
            transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .btn-modern:active {
            transform: scale(0.97);
        }

        .view-transition {
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .view-hidden {
            opacity: 0;
            pointer-events: none;
            position: absolute;
            inset: 0;
            transform: scale(0.98);
            z-index: -1;
        }

        .view-active {
            opacity: 1;
            pointer-events: auto;
            position: relative;
            transform: scale(1);
            z-index: 10;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
        }

        /* Install Banner */
        .install-banner {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideDown {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .install-banner.hidden {
            display: none;
        }
    </style>
</head>

<body class="antialiased text-gray-800">

    <!-- Install App Banner (hidden by default, shown only when app can be installed) -->
    <div id="install-banner" class="install-banner hidden fixed top-0 left-0 right-0 z-50 px-4 py-3 shadow-lg">
        <div class="max-w-lg mx-auto flex items-center justify-between gap-3">
            <div class="flex items-center gap-3">
                <img src="pwa_icon.png" alt="Succes" class="w-10 h-10 rounded-lg shadow-md">
                <div class="text-white">
                    <p class="font-semibold text-sm">Install Succes</p>
                    <p class="text-xs text-white/70">Add to home screen</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="Auth.dismissInstall()" class="text-white/70 hover:text-white px-2 py-1 text-sm">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <button onclick="Auth.installApp()" class="bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg text-sm shadow-md hover:bg-blue-50 transition-all">
                    Install
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"
        class="fixed top-4 left-0 right-0 z-50 pointer-events-none flex flex-col items-center gap-2 p-4"></div>

    <!-- MAIN APP CONTAINER -->
    <main id="app"
        class="relative w-full h-full max-w-lg mx-auto bg-white/50 shadow-2xl overflow-hidden md:max-w-none md:w-full md:h-full md:my-0 md:rounded-none md:border-0 backdrop-blur-3xl">

        <!-- ================= SCREEN 1: ENTRY (Role Selection + Student Form) ================= -->
        <section id="view-entry" class="view-active w-full h-full flex flex-col p-8 transition-all duration-500">
            <!-- Header/Logo -->
            <div class="flex-1 flex flex-col items-center justify-center space-y-6 animate-slide-up">
                <div class="relative w-28 h-28">
                    <img src="pwa_icon.png" alt="Succes Class Logo" class="w-full h-full object-contain rounded-2xl shadow-lg">
                    <div
                        class="absolute -right-2 -top-2 bg-red-50 text-red-500 text-[10px] font-bold px-1.5 py-0.5 rounded-md border border-red-100">
                        1.0</div>
                </div>
            </div>

            <!-- Student Login Form -->
            <div id="form-student" class="w-full space-y-5 mb-4 animate-slide-up" style="animation-delay: 0.1s;">
                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1">Conversation Code</label>
                    <div class="relative flex gap-2">
                        <input id="login-code" type="text" placeholder="Enter conversation code"
                            class="input-glass flex-1 px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 placeholder-gray-400 bg-gray-50/50 border-gray-200 focus:bg-white transition-all">
                        <div
                            class="w-12 flex items-center justify-center bg-gray-100 rounded-lg text-gray-500 text-2xl">
                            <i class="fa-solid fa-qrcode"></i>
                        </div>
                    </div>
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1">Username</label>
                    <input id="login-name" type="text" placeholder="Enter Username"
                        class="input-glass w-full px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 placeholder-gray-400 bg-gray-50/50 border-gray-200 focus:bg-white">
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1">Receiving Language</label>
                    <div class="relative">
                        <select id="login-lang" title="Select your receiving language"
                            class="input-glass w-full px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 appearance-none bg-gray-50/50 border-gray-200 focus:bg-white pr-10 truncate">
                            <!-- Populated dynamically -->
                        </select>
                        <i
                            class="fa-solid fa-caret-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <button onclick="Auth.handleStudentLogin()"
                    class="btn-modern w-full bg-[#0ea5e9] hover:bg-[#0284c7] text-white font-semibold py-3.5 rounded-lg shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2 mt-4 text-lg">
                    <span>Join Conversation</span>
                </button>
            </div>

            <!-- Footer / Teacher Toggle -->
            <div id="login-footer" class="text-center animate-slide-up mt-auto pt-4" style="animation-delay: 0.2s;">
                <button onclick="Auth.showTeacherLogin()"
                    class="w-full py-3.5 rounded-lg font-semibold text-white bg-[#22c55e] hover:bg-[#16a34a] shadow-lg shadow-green-500/20 transition-all flex items-center justify-center gap-2">
                    <span>Teacher</span>
                </button>
            </div>
        </section>

        <!-- ================= SCREEN 2: TEACHER LOGIN ================= -->
        <section id="view-teacher-login" class="view-hidden w-full h-full flex flex-col p-8 transition-all duration-500">
            <!-- Header/Logo -->
            <div class="flex-1 flex flex-col items-center justify-center space-y-6 animate-slide-up">
                <div class="relative w-24 h-24">
                    <img src="pwa_icon.png" alt="Succes Class Logo" class="w-full h-full object-contain rounded-2xl shadow-lg">
                </div>
                <div class="text-center">
                    <h2 class="text-xl font-bold text-gray-900">Teacher Login</h2>
                    <p class="text-sm text-gray-500 mt-1">Sign in to start your session</p>
                </div>
            </div>

            <!-- Teacher Login Form -->
            <div class="w-full space-y-5 mb-4 animate-slide-up">
                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1" for="teacher-email">Email</label>
                    <input id="teacher-email" type="email" value="teacher@adahconnect.com" placeholder="Email"
                        title="Teacher Email"
                        class="input-glass w-full px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 placeholder-gray-400 bg-gray-50/50 border-gray-200 focus:bg-white">
                </div>
                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1" for="teacher-pw">Password</label>
                    <input id="teacher-pw" type="password" value="teacher456321" placeholder="Password"
                        title="Teacher Password"
                        class="input-glass w-full px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 placeholder-gray-400 bg-gray-50/50 border-gray-200 focus:bg-white">
                </div>
                <div class="group">
                    <label class="block text-sm font-semibold text-gray-500 mb-1.5 ml-1">Language</label>
                    <div class="relative">
                        <select id="teacher-lang" title="Select your instruction language"
                            class="input-glass w-full px-4 py-3.5 rounded-lg text-base font-medium text-gray-800 appearance-none bg-gray-50/50 border-gray-200 focus:bg-white pr-10 truncate">
                            <!-- Populated dynamically -->
                        </select>
                        <i
                            class="fa-solid fa-caret-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <button onclick="Auth.handleTeacherLogin()"
                    class="btn-modern w-full bg-[#22c55e] hover:bg-[#16a34a] text-white font-semibold py-3.5 rounded-lg shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 mt-4 text-lg">
                    <span>Login & Start</span>
                </button>
                <button onclick="Auth.showStudentLogin()"
                    class="w-full py-2 text-sm font-semibold text-gray-400 hover:text-gray-600">
                    <i class="fa-solid fa-arrow-left mr-1"></i> Back to Student Login
                </button>
            </div>
        </section>

    </main>

    <!-- ================= LOGIC ================= -->
    <script>
        // --- LANGUAGES ---
        const LANGUAGES = [
            { code: 'nl-BE', name: 'Flemish', flag: 'ðŸ‡§ðŸ‡ª' },
            { code: 'ab', name: 'Abkhaz', flag: 'ðŸ‡¬ðŸ‡ª' },
            { code: 'ace', name: 'Acehnese', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'ach', name: 'Acholi', flag: 'ðŸ‡ºðŸ‡¬' },
            { code: 'aa', name: 'Afar', flag: 'ðŸ‡ªðŸ‡¹' },
            { code: 'af', name: 'Afrikaans', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'sq', name: 'Albanian', flag: 'ðŸ‡¦ðŸ‡±' },
            { code: 'alu', name: 'Alur', flag: 'ðŸ‡¨ðŸ‡¬' },
            { code: 'am', name: 'Amharic', flag: 'ðŸ‡ªðŸ‡¹' },
            { code: 'ar', name: 'Arabic', flag: 'ðŸ‡¸ðŸ‡¦' },
            { code: 'hy', name: 'Armenian', flag: 'ðŸ‡¦ðŸ‡²' },
            { code: 'as', name: 'Assamese', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'av', name: 'Avar', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'awa', name: 'Awadhi', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'ay', name: 'Aymara', flag: 'ðŸ‡§ðŸ‡´' },
            { code: 'az', name: 'Azerbaijani', flag: 'ðŸ‡¦ðŸ‡¿' },
            { code: 'ban', name: 'Balinese', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'bal', name: 'Baluchi', flag: 'ðŸ‡µðŸ‡°' },
            { code: 'bm', name: 'Bambara', flag: 'ðŸ‡²ðŸ‡±' },
            { code: 'bau', name: 'BaoulÃ©', flag: 'ðŸ‡¨ðŸ‡®' },
            { code: 'ba', name: 'Bashkir', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'eu', name: 'Basque', flag: 'ðŸ‡ªðŸ‡¸' },
            { code: 'btk', name: 'Batak Karo', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'bts', name: 'Batak Simalungun', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'bbc', name: 'Batak Toba', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'be', name: 'Belarusian', flag: 'ðŸ‡§ðŸ‡¾' },
            { code: 'bem', name: 'Bemba', flag: 'ðŸ‡¿ðŸ‡²' },
            { code: 'bn', name: 'Bengali', flag: 'ðŸ‡§ðŸ‡©' },
            { code: 'btv', name: 'Betawi', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'bho', name: 'Bhojpuri', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'bik', name: 'Bikol', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'bs', name: 'Bosnian', flag: 'ðŸ‡§ðŸ‡¦' },
            { code: 'br', name: 'Breton', flag: 'ðŸ‡«ðŸ‡·' },
            { code: 'bg', name: 'Bulgarian', flag: 'ðŸ‡§ðŸ‡¬' },
            { code: 'bua', name: 'Buryat', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'yue', name: 'Cantonese', flag: 'ðŸ‡­ðŸ‡°' },
            { code: 'ca', name: 'Catalan', flag: 'ðŸ‡ªðŸ‡¸' },
            { code: 'ceb', name: 'Cebuano', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'ch', name: 'Chamorro', flag: 'ðŸ‡¬ðŸ‡º' },
            { code: 'ce', name: 'Chechen', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'ny', name: 'Chichewa', flag: 'ðŸ‡²ðŸ‡¼' },
            { code: 'zh-CN', name: 'Chinese (Simplified)', flag: 'ðŸ‡¨ðŸ‡³' },
            { code: 'zh-TW', name: 'Chinese (Traditional)', flag: 'ðŸ‡¹ðŸ‡¼' },
            { code: 'chk', name: 'Chuukese', flag: 'ðŸ‡«ðŸ‡²' },
            { code: 'cv', name: 'Chuvash', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'co', name: 'Corsican', flag: 'ðŸ‡«ðŸ‡·' },
            { code: 'crh', name: 'Crimean Tatar (Latin)', flag: 'ðŸ‡ºðŸ‡¦' },
            { code: 'hr', name: 'Croatian', flag: 'ðŸ‡­ðŸ‡·' },
            { code: 'cs', name: 'Czech', flag: 'ðŸ‡¨ðŸ‡¿' },
            { code: 'da', name: 'Danish', flag: 'ðŸ‡©ðŸ‡°' },
            { code: 'prs', name: 'Dari', flag: 'ðŸ‡¦ðŸ‡«' },
            { code: 'dv', name: 'Dhivehi', flag: 'ðŸ‡²ðŸ‡»' },
            { code: 'din', name: 'Dinka', flag: 'ðŸ‡¸ðŸ‡¸' },
            { code: 'doi', name: 'Dogri', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'nl', name: 'Dutch', flag: 'ðŸ‡³ðŸ‡±' },
            { code: 'dyu', name: 'Dyula', flag: 'ðŸ‡¨ðŸ‡®' },
            { code: 'dz', name: 'Dzongkha', flag: 'ðŸ‡§ðŸ‡¹' },
            { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
            { code: 'eo', name: 'Esperanto', flag: 'ðŸŒ' },
            { code: 'et', name: 'Estonian', flag: 'ðŸ‡ªðŸ‡ª' },
            { code: 'ee', name: 'Ewe', flag: 'ðŸ‡¬ðŸ‡­' },
            { code: 'fo', name: 'Faroese', flag: 'ðŸ‡«ðŸ‡´' },
            { code: 'fj', name: 'Fijian', flag: 'ðŸ‡«ðŸ‡¯' },
            { code: 'fil', name: 'Filipino', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'fi', name: 'Finnish', flag: 'ðŸ‡«ðŸ‡®' },
            { code: 'fon', name: 'Fon', flag: 'ðŸ‡§ðŸ‡¯' },
            { code: 'fr', name: 'French', flag: 'ðŸ‡«ðŸ‡·' },
            { code: 'fr-CA', name: 'French (Canada)', flag: 'ðŸ‡¨ðŸ‡¦' },
            { code: 'fy', name: 'Frisian', flag: 'ðŸ‡³ðŸ‡±' },
            { code: 'fur', name: 'Friulian', flag: 'ðŸ‡®ðŸ‡¹' },
            { code: 'ff', name: 'Fulani', flag: 'ðŸ‡¸ðŸ‡³' },
            { code: 'gaa', name: 'Ga', flag: 'ðŸ‡¬ðŸ‡­' },
            { code: 'gl', name: 'Galician', flag: 'ðŸ‡ªðŸ‡¸' },
            { code: 'ka', name: 'Georgian', flag: 'ðŸ‡¬ðŸ‡ª' },
            { code: 'de', name: 'German', flag: 'ðŸ‡©ðŸ‡ª' },
            { code: 'el', name: 'Greek', flag: 'ðŸ‡¬ðŸ‡·' },
            { code: 'gn', name: 'Guarani', flag: 'ðŸ‡µðŸ‡¾' },
            { code: 'gu', name: 'Gujarati', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'ht', name: 'Haitian Creole', flag: 'ðŸ‡­ðŸ‡¹' },
            { code: 'ccp', name: 'Hakha Chin', flag: 'ðŸ‡²ðŸ‡²' },
            { code: 'ha', name: 'Hausa', flag: 'ðŸ‡³ðŸ‡¬' },
            { code: 'haw', name: 'Hawaiian', flag: 'ðŸ‡ºðŸ‡¸' },
            { code: 'he', name: 'Hebrew', flag: 'ðŸ‡®ðŸ‡±' },
            { code: 'hil', name: 'Hiligaynon', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'hi', name: 'Hindi', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'hmn', name: 'Hmong', flag: 'ðŸ‡¨ðŸ‡³' },
            { code: 'hu', name: 'Hungarian', flag: 'ðŸ‡­ðŸ‡º' },
            { code: 'iba', name: 'Iban', flag: 'ðŸ‡²ðŸ‡¾' },
            { code: 'is', name: 'Icelandic', flag: 'ðŸ‡®ðŸ‡¸' },
            { code: 'ig', name: 'Igbo', flag: 'ðŸ‡³ðŸ‡¬' },
            { code: 'ilo', name: 'Ilocano', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'id', name: 'Indonesian', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'iu', name: 'Inuktut', flag: 'ðŸ‡¨ðŸ‡¦' },
            { code: 'ga', name: 'Irish', flag: 'ðŸ‡®ðŸ‡ª' },
            { code: 'it', name: 'Italian', flag: 'ðŸ‡®ðŸ‡¹' },
            { code: 'jam', name: 'Jamaican Patois', flag: 'ðŸ‡¯ðŸ‡²' },
            { code: 'ja', name: 'Japanese', flag: 'ðŸ‡¯ðŸ‡µ' },
            { code: 'jv', name: 'Javanese', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'kac', name: 'Jingpo', flag: 'ðŸ‡²ðŸ‡²' },
            { code: 'kl', name: 'Kalaallisut', flag: 'ðŸ‡¬ðŸ‡±' },
            { code: 'kn', name: 'Kannada', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'kr', name: 'Kanuri', flag: 'ðŸ‡³ðŸ‡¬' },
            { code: 'pam', name: 'Kapampangan', flag: 'ðŸ‡µðŸ‡­' },
            { code: 'kk', name: 'Kazakh', flag: 'ðŸ‡°ðŸ‡¿' },
            { code: 'kha', name: 'Khasi', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'km', name: 'Khmer', flag: 'ðŸ‡°ðŸ‡­' },
            { code: 'kg', name: 'Kikongo', flag: 'ðŸ‡¨ðŸ‡¬' },
            { code: 'rw', name: 'Kinyarwanda', flag: 'ðŸ‡·ðŸ‡¼' },
            { code: 'ko', name: 'Korean', flag: 'ðŸ‡°ðŸ‡·' },
            { code: 'kri', name: 'Krio', flag: 'ðŸ‡¸ðŸ‡±' },
            { code: 'ku', name: 'Kurdish (Kurmanji)', flag: 'ðŸ‡¹ðŸ‡·' },
            { code: 'ckb', name: 'Kurdish (Sorani)', flag: 'ðŸ‡®ðŸ‡¶' },
            { code: 'ky', name: 'Kyrgyz', flag: 'ðŸ‡°ðŸ‡¬' },
            { code: 'lo', name: 'Lao', flag: 'ðŸ‡±ðŸ‡¦' },
            { code: 'la', name: 'Latin', flag: 'ðŸ‡»ðŸ‡¦' },
            { code: 'lv', name: 'Latvian', flag: 'ðŸ‡±ðŸ‡»' },
            { code: 'ln', name: 'Lingala', flag: 'ðŸ‡¨ðŸ‡©' },
            { code: 'lt', name: 'Lithuanian', flag: 'ðŸ‡±ðŸ‡¹' },
            { code: 'lg', name: 'Luganda', flag: 'ðŸ‡ºðŸ‡¬' },
            { code: 'luo', name: 'Luo', flag: 'ðŸ‡°ðŸ‡ª' },
            { code: 'lb', name: 'Luxembourgish', flag: 'ðŸ‡±ðŸ‡º' },
            { code: 'mk', name: 'Macedonian', flag: 'ðŸ‡²ðŸ‡°' },
            { code: 'mad', name: 'Madurese', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'mai', name: 'Maithili', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'mg', name: 'Malagasy', flag: 'ðŸ‡²ðŸ‡¬' },
            { code: 'ms', name: 'Malay', flag: 'ðŸ‡²ðŸ‡¾' },
            { code: 'ml', name: 'Malayalam', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'mt', name: 'Maltese', flag: 'ðŸ‡²ðŸ‡¹' },
            { code: 'gv', name: 'Manx', flag: 'ðŸ‡®ðŸ‡²' },
            { code: 'mi', name: 'Maori', flag: 'ðŸ‡³ðŸ‡¿' },
            { code: 'mr', name: 'Marathi', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'mh', name: 'Marshallese', flag: 'ðŸ‡²ðŸ‡­' },
            { code: 'mn', name: 'Mongolian', flag: 'ðŸ‡²ðŸ‡³' },
            { code: 'my', name: 'Myanmar (Burmese)', flag: 'ðŸ‡²ðŸ‡²' },
            { code: 'ne', name: 'Nepali', flag: 'ðŸ‡³ðŸ‡µ' },
            { code: 'no', name: 'Norwegian', flag: 'ðŸ‡³ðŸ‡´' },
            { code: 'or', name: 'Odia (Oriya)', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'om', name: 'Oromo', flag: 'ðŸ‡ªðŸ‡¹' },
            { code: 'ps', name: 'Pashto', flag: 'ðŸ‡¦ðŸ‡«' },
            { code: 'fa', name: 'Persian', flag: 'ðŸ‡®ðŸ‡·' },
            { code: 'pl', name: 'Polish', flag: 'ðŸ‡µðŸ‡±' },
            { code: 'pt-BR', name: 'Portuguese (Brazil)', flag: 'ðŸ‡§ðŸ‡·' },
            { code: 'pt-PT', name: 'Portuguese (Portugal)', flag: 'ðŸ‡µðŸ‡¹' },
            { code: 'pa', name: 'Punjabi', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'qu', name: 'Quechua', flag: 'ðŸ‡µðŸ‡ª' },
            { code: 'ro', name: 'Romanian', flag: 'ðŸ‡·ðŸ‡´' },
            { code: 'rn', name: 'Rundi', flag: 'ðŸ‡§ðŸ‡®' },
            { code: 'ru', name: 'Russian', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'sm', name: 'Samoan', flag: 'ðŸ‡¼ðŸ‡¸' },
            { code: 'sg', name: 'Sango', flag: 'ðŸ‡¨ðŸ‡«' },
            { code: 'sa', name: 'Sanskrit', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'gd', name: 'Scots Gaelic', flag: 'ðŸ´ó §ó ¢ó ³ó £ó ´ó ¿' },
            { code: 'nso', name: 'Sepedi', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'sr', name: 'Serbian', flag: 'ðŸ‡·ðŸ‡¸' },
            { code: 'st', name: 'Sesotho', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'sn', name: 'Shona', flag: 'ðŸ‡¿ðŸ‡¼' },
            { code: 'sd', name: 'Sindhi', flag: 'ðŸ‡µðŸ‡°' },
            { code: 'si', name: 'Sinhala', flag: 'ðŸ‡±ðŸ‡°' },
            { code: 'sk', name: 'Slovak', flag: 'ðŸ‡¸ðŸ‡°' },
            { code: 'sl', name: 'Slovenian', flag: 'ðŸ‡¸ðŸ‡®' },
            { code: 'so', name: 'Somali', flag: 'ðŸ‡¸ðŸ‡´' },
            { code: 'es', name: 'Spanish', flag: 'ðŸ‡ªðŸ‡¸' },
            { code: 'su', name: 'Sundanese', flag: 'ðŸ‡®ðŸ‡©' },
            { code: 'sw', name: 'Swahili', flag: 'ðŸ‡°ðŸ‡ª' },
            { code: 'ss', name: 'Swati', flag: 'ðŸ‡¸ðŸ‡¿' },
            { code: 'sv', name: 'Swedish', flag: 'ðŸ‡¸ðŸ‡ª' },
            { code: 'ty', name: 'Tahitian', flag: 'ðŸ‡µðŸ‡«' },
            { code: 'tg', name: 'Tajik', flag: 'ðŸ‡¹ðŸ‡¯' },
            { code: 'ta', name: 'Tamil', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'tt', name: 'Tatar', flag: 'ðŸ‡·ðŸ‡º' },
            { code: 'te', name: 'Telugu', flag: 'ðŸ‡®ðŸ‡³' },
            { code: 'th', name: 'Thai', flag: 'ðŸ‡¹ðŸ‡­' },
            { code: 'bo', name: 'Tibetan', flag: 'ðŸ‡¨ðŸ‡³' },
            { code: 'ti', name: 'Tigrinya', flag: 'ðŸ‡ªðŸ‡·' },
            { code: 'to', name: 'Tongan', flag: 'ðŸ‡¹ðŸ‡´' },
            { code: 'ts', name: 'Tsonga', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'tn', name: 'Tswana', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'tr', name: 'Turkish', flag: 'ðŸ‡¹ðŸ‡·' },
            { code: 'tk', name: 'Turkmen', flag: 'ðŸ‡¹ðŸ‡²' },
            { code: 'ak', name: 'Twi', flag: 'ðŸ‡¬ðŸ‡­' },
            { code: 'uk', name: 'Ukrainian', flag: 'ðŸ‡ºðŸ‡¦' },
            { code: 'ur', name: 'Urdu', flag: 'ðŸ‡µðŸ‡°' },
            { code: 'ug', name: 'Uyghur', flag: 'ðŸ‡¨ðŸ‡³' },
            { code: 'uz', name: 'Uzbek', flag: 'ðŸ‡ºðŸ‡¿' },
            { code: 've', name: 'Venda', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'vi', name: 'Vietnamese', flag: 'ðŸ‡»ðŸ‡³' },
            { code: 'cy', name: 'Welsh', flag: 'ðŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿' },
            { code: 'wo', name: 'Wolof', flag: 'ðŸ‡¸ðŸ‡³' },
            { code: 'xh', name: 'Xhosa', flag: 'ðŸ‡¿ðŸ‡¦' },
            { code: 'yi', name: 'Yiddish', flag: 'ðŸ‡®ðŸ‡±' },
            { code: 'yo', name: 'Yoruba', flag: 'ðŸ‡³ðŸ‡¬' },
            { code: 'zu', name: 'Zulu', flag: 'ðŸ‡¿ðŸ‡¦' }
        ];

        // --- AUTH CONTROLLER ---
        // PWA Install prompt
        let deferredPrompt = null;

        const Auth = {
            init() {
                // Check if app is already installed
                this.checkInstallState();
                // Populate language selects
                const ops = LANGUAGES.map(l => `<option value="${l.code}" ${l.code === 'nl-BE' ? 'selected' : ''}>${l.flag || ''} ${l.name}</option>`).join('');
                document.getElementById('login-lang').innerHTML = ops;
                document.getElementById('teacher-lang').innerHTML = ops;

                // Check if already logged in
                const saved = localStorage.getItem('orbit_session');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (data.role && data.room) {
                            // Redirect to main app
                            window.location.href = 'index.html';
                            return;
                        }
                    } catch (e) { }
                }
            },

            switchView(viewId) {
                document.querySelectorAll('section').forEach(el => {
                    el.classList.remove('view-active');
                    el.classList.add('view-hidden');
                });
                const target = document.getElementById(viewId);
                setTimeout(() => {
                    target.classList.remove('view-hidden');
                    target.classList.add('view-active');
                }, 50);
            },

            showTeacherLogin() {
                this.switchView('view-teacher-login');
            },

            showStudentLogin() {
                this.switchView('view-entry');
            },

            showToast(msg, type = 'info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                const colors = { info: 'bg-gray-800 text-white', success: 'bg-green-600 text-white', error: 'bg-red-500 text-white' };
                toast.className = `${colors[type]} px-4 py-2 rounded-lg shadow-xl text-sm font-semibold transform transition-all duration-300 translate-y-[-20px] opacity-0 flex items-center gap-2`;
                toast.innerHTML = type === 'success' ? `<i class="fa-solid fa-check-circle"></i> ${msg}` : msg;
                container.appendChild(toast);
                requestAnimationFrame(() => toast.classList.remove('translate-y-[-20px]', 'opacity-0'));
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'translate-y-[-10px]');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },

            handleStudentLogin() {
                const code = document.getElementById('login-code').value.trim().toUpperCase();
                const name = document.getElementById('login-name').value.trim();
                const lang = document.getElementById('login-lang').value;

                if (!code) {
                    this.showToast("Please enter room code", "error");
                    return;
                }
                if (!name) {
                    this.showToast("Please enter your name", "error");
                    return;
                }

                // Save session and redirect
                const session = {
                    role: 'student',
                    room: code,
                    name: name,
                    lang: lang,
                    currentView: 'view-student'
                };
                localStorage.setItem('orbit_session', JSON.stringify(session));
                this.showToast("Joining classroom...", "success");

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
            },

            handleTeacherLogin() {
                const email = document.getElementById('teacher-email').value.trim();
                const pw = document.getElementById('teacher-pw').value;
                const lang = document.getElementById('teacher-lang').value;

                // Validate credentials
                if (email !== "teacher@adahconnect.com" || pw !== "teacher456321") {
                    this.showToast("Invalid credentials", "error");
                    return;
                }

                // Generate room code
                const roomCode = "RM" + Math.floor(1000 + Math.random() * 9000);

                // Save session and redirect
                const session = {
                    role: 'teacher',
                    room: roomCode,
                    name: 'Teacher',
                    lang: lang,
                    currentView: 'view-lobby'
                };
                localStorage.setItem('orbit_session', JSON.stringify(session));
                this.showToast("Login successful!", "success");

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
            },

            // Check if PWA is installed and show/hide banner
            checkInstallState() {
                const banner = document.getElementById('install-banner');
                
                // Check if running as installed PWA
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                                     window.navigator.standalone === true ||
                                     document.referrer.includes('android-app://') ||
                                     localStorage.getItem('pwa_installed') === 'true';
                
                if (isStandalone) {
                    banner.classList.add('hidden');
                    return;
                }

                // Listen for install prompt
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    banner.classList.remove('hidden');
                });

                // Listen for successful install
                window.addEventListener('appinstalled', () => {
                    banner.classList.add('hidden');
                    deferredPrompt = null;
                    localStorage.setItem('pwa_installed', 'true');
                    this.showToast('App installed successfully!', 'success');
                });
            },

            async installApp() {
                if (!deferredPrompt) {
                    this.showToast('Install not available', 'error');
                    return;
                }

                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    localStorage.setItem('pwa_installed', 'true');
                }
                deferredPrompt = null;
            },

            dismissInstall() {
                const banner = document.getElementById('install-banner');
                banner.classList.add('hidden');
                // Remember dismissal for this session
                sessionStorage.setItem('install_dismissed', 'true');
            }
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => Auth.init());
    </script>

</body>

</html>
